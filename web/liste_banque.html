<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Liste des banques</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="js/jtable/themes/metro/blue/jtable.min.css" />
    <link rel="stylesheet" href="css/validationEngine.jquery.css" type="text/css"/>
    <script type="text/javascript" src="js/jquery-1.11.2.js"></script>
    <script type="text/javascript" src="js/jquery-ui.js"></script>
    <script type="text/javascript" src="js/jtable/jquery.jtable.js"></script>
    <script type="text/javascript" src="js/jtable/localization/jquery.jtable.fr.js">
    <script type="text/javascript" charset="utf-8" src="js/jquery.validationEngine.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/jquery.validationEngine-fr.js"></script>
  </head>

  <body>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#lst_banque').jtable({
                title: 'Liste des banques',
                ajaxSettings: { type: 'POST' },
                editinline:{enable:true},
                actions: {
                    listAction: function (postData, jtParams) {
                        return $.Deferred(function ($dfd) {
                            $.ajax({
                                url: 'http://localhost:8080/banque',
                                type: 'GET',
                                dataType: 'json',
                                success: function (data) {
                                    dict_data = {
                                                    Result: "OK",
                                                    Records: data
                                                }
                                    $dfd.resolve(dict_data);
                                },
                                error: function () {
                                    $dfd.reject();
                                }
                            });
                        });
                    },
                    createAction: function(postData) {
                        //https://github.com/hikalkan/jtable/issues/64
                        var jsonData = {};
                        $.map(postData, function(n, i) {
                                            jsonData[n['name']] = n['value'];
                                        });
                        return $.Deferred(function ($dfd) {
                            $.ajax({
                                url: 'http://localhost:8080/banque',
                                type: 'POST',
                                dataType: 'json',
                                data: JSON.stringify(jsonData)
                                }).done(function(data, textStatus, jqXHR){
                                    if (jqXHR.status == 201) {
                                        dict_data = {
                                                        Result: "OK",
                                                        Record: data
                                                    }
                                        $dfd.resolve(dict_data);
                                    }
                                    else {
                                        $dfd.reject();
                                    }
                                }).fail(function(jqXHR, textStatus, errorThrown){
                                    $dfd.reject();
                                });
                            });
                    },
                    updateAction: function(postData) {
                        var jsonData = {};
                        $.map(postData, function(n, i) {
                                            jsonData[n['name']] = n['value'];
                                        });
                        return $.Deferred(function ($dfd) {
                            $.ajax({
                                url: 'http://localhost:8080/banque/' + jsonData['id'],
                                type: 'PUT',
                                dataType: 'json',
                                data: JSON.stringify(jsonData),
                                success: function (data) {
                                    dict_data = {
                                                    Result: "OK",
                                                }
                                    $dfd.resolve(dict_data);
                                },
                                error: function () {
                                    $dfd.reject();
                                }
                                });
                            });
                    }, 
                    deleteAction: function(postData) {
                        return $.Deferred(function ($dfd) {
                            $.ajax({
                                url: 'http://localhost:8080/banque/' + postData['id'],
                                type: 'DELETE',
                                dataType: 'json',
                                success: function (data) {
                                    console.log(data);
                                    dict_data = {
                                                    Result: "OK",
                                                }
                                    $dfd.resolve(dict_data);
                                },
                                error: function () {
                                    $dfd.reject();
                                }
                                });
                            });
                    }, 
                },
                fields: {
                    id: {
                        key: true,
                        list: false
                    },
                    nom: {
                        title: 'Nom',
                        width: '20%'
                    },
                    adresse: {
                        title: 'Adresse',
                        width: '40%'
                    },
                    cp: {
                        title: 'Code Postal',
                        width: '10%',
                        inputClass: 'validate[required,maxSize[5],custom[integer]]',
                        inputSize: '5'
                    },
                    ville: {
                        title: 'Ville',
                        width: '10%',
                    },
                    code_banque: {
                        title: 'Code Banque',
                        width: '10%',
                        inputClass: 'validate[required,maxSize[5],custom[integer]]',
                        inputSize: '5'
                    },
                    code_guichet: {
                        title: 'Code Guichet',
                        width: '10%',
                        inputClass: 'validate[required,maxSize[5],custom[integer]]',
                        inputSize: '5'
                    }
                }
            });
            $('#lst_banque').jtable('load');
        });
    </script>
    <h1>Liste des banques</h1>
        <div id="lst_banque"></div>
  </body>
</html>


